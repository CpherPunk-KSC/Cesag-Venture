<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Admin â€“ CESAG Venture</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Poppins&display=swap" rel="stylesheet">
<style>
body { font-family:Poppins; background:#f4f6fa; margin:0; }
header { background:#2E7D32; color:#FFD700; padding:20px; text-align:center; }
.login, .dashboard { max-width:900px; margin:40px auto; background:#fff; padding:30px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,.1); }
input, button { width:100%; padding:12px; margin:10px 0; }
button { background:#2E7D32; color:#FFD700; border:none; border-radius:8px; font-weight:bold; cursor:pointer; }
button:hover { background:#1B5E20; transform:scale(1.05); }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { padding:10px; border-bottom:1px solid #ddd; font-size:14px; }
th { background:#2E7D32; color:#FFD700; }
.logout { background:#FFD700; color:#2E7D32; margin-top:20px; }
</style>
</head>
<body>

<header>
  <h2>CESAG Venture â€“ Admin</h2>
</header>

<!-- LOGIN -->
<div class="login" id="loginBox">
  <h3>Connexion Admin</h3>
  <input type="email" id="email" placeholder="Email admin">
  <input type="password" id="password" placeholder="Mot de passe">
  <button onclick="login()">Connexion</button>
</div>

<!-- DASHBOARD -->
<div class="dashboard" id="dashboard" style="display:none;">
  <h3>Liste des membres</h3>
  <table>
    <thead>
      <tr>
        <th>Nom</th>
        <th>PrÃ©nom</th>
        <th>Email</th>
        <th>TÃ©lÃ©phone</th>
        <th>Section</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="membersTable"></tbody>
  </table>
  <p>Total membres : <span id="totalMembers">0</span></p>
  <button class="logout" onclick="logout()">DÃ©connexion</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ðŸ”¹ Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyC7igDhs1cZf1gD8QbIZMCDpuGmflhml7c",
  authDomain: "cesag-venture.firebaseapp.com",
  projectId: "cesag-venture",
  storageBucket: "cesag-venture.firebasestorage.app",
  messagingSenderId: "524957177736",
  appId: "1:524957177736:web:47835b4e1152118389cc3d"
};

// ðŸ”¹ Initialisation
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ðŸ”¹ LOGIN
window.login = () => {
  signInWithEmailAndPassword(auth, email.value, password.value)
    .catch(() => alert("Connexion refusÃ©e !"));
};

// ðŸ”¹ AUTH CHECK
onAuthStateChanged(auth, async (user) => {
  if(user){
    loginBox.style.display = "none";
    dashboard.style.display = "block";
    await loadMembers();
  } else {
    loginBox.style.display = "block";
    dashboard.style.display = "none";
  }
});

// ðŸ”¹ LOAD MEMBERS
async function loadMembers(){
  const table = document.getElementById("membersTable");
  table.innerHTML = "";
  const snapshot = await getDocs(collection(db,"membres"));
  let count = 0;
  snapshot.forEach(docSnap => {
    const m = docSnap.data();
    count++;
    table.innerHTML += `
      <tr>
        <td>${m.nom}</td>
        <td>${m.prenom}</td>
        <td>${m.email}</td>
        <td>${m.telephone}</td>
        <td>${m.section}</td>
        <td><button onclick="deleteMember('${docSnap.id}')">Supprimer</button></td>
      </tr>
    `;
  });
  document.getElementById("totalMembers").innerText = count;
}

// ðŸ”¹ DELETE MEMBER
window.deleteMember = async (id) => {
  if(confirm("Supprimer ce membre ?")){
    await deleteDoc(doc(db,"membres",id));
    await loadMembers();
  }
}

// ðŸ”¹ LOGOUT
window.logout = () => signOut(auth);

</script>

</body>
</html>
