<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adhésion – CESAG Venture</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Poppins:wght@400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:#f9f9f9;color:#2E7D32;}
header{background:#2E7D32;color:#fff;padding:20px 50px;display:flex;justify-content:space-between;align-items:center;}
header nav a{margin-left:25px;font-weight:bold;color:#fff;text-decoration:none;}
header nav a:hover{color:#FFD700;}
.hero{height:50vh;background:linear-gradient(rgba(46,125,50,.7),rgba(46,125,50,.7)),url('https://images.unsplash.com/photo-1565372911337-81f2f9b4a768') center/cover;color:#FFD700;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;}
.container{max-width:600px;margin:50px auto;background:#fff;padding:40px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.1);opacity:0;transform:translateY(40px);transition:.8s;}
.container.visible{opacity:1;transform:none;}
label{font-weight:bold;}
input{width:100%;padding:12px;margin:10px 0 20px;border-radius:6px;border:1px solid #ccc;}
button{width:100%;padding:15px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;}
#generateBtn{background:#2E7D32;color:#FFD700;}
#backBtn{background:#FFD700;color:#2E7D32;display:none;margin-top:10px;}
footer{background:#2E7D32;color:#fff;text-align:center;padding:30px;}
</style>
</head>

<body>

<header>
<h2>CESAG Venture</h2>
<nav>
<a href="index.html">Accueil</a>
<a href="adhesion.html">Adhésion</a>
</nav>
</header>

<section class="hero">
<h1>Formulaire d’adhésion</h1>
<p>Obtenez votre carte membre officielle</p>
</section>

<div class="container" id="membershipFormContainer">
<h2>Adhésion CESAG Venture</h2>

<form id="membershipForm">
<label>Nom</label>
<input id="nom" required>

<label>Prénom</label>
<input id="prenom" required>

<label>Email</label>
<input type="email" id="email" required>

<label>Téléphone</label>
<input id="telephone" required>

<label>Section / Filière</label>
<input id="section" required>

<button id="generateBtn" type="submit">Générer ma carte</button>
</form>

<button id="backBtn" onclick="location.href='index.html'">Retour au site</button>
</div>

<footer>
<p>©️ 2026 CESAG Venture</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyC7igDhs1cZf1gD8QbIZMCDpuGmflhml7c",
  authDomain: "cesag-venture.firebaseapp.com",
  projectId: "cesag-venture",
  storageBucket: "cesag-venture.firebasestorage.app",
  messagingSenderId: "524957177736",
  appId: "1:524957177736:web:47835b4e1152118389cc3d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const form = document.getElementById("membershipForm");
const backBtn = document.getElementById("backBtn");

form.addEventListener("submit", async (e)=>{
e.preventDefault();

const nom = document.getElementById("nom").value;
const prenom = document.getElementById("prenom").value;
const email = document.getElementById("email").value;
const telephone = document.getElementById("telephone").value;
const section = document.getElementById("section").value;

/* SAVE FIREBASE */
await addDoc(collection(db,"membres"),{
nom,prenom,email,telephone,section,
dateInscription: serverTimestamp()
});

/* PDF CARD */
const { jsPDF } = window.jspdf;
const doc = new jsPDF({orientation:"landscape",unit:"mm",format:[85.6,53.98]});
doc.setFillColor(46,125,50); // vert
doc.rect(0,0,85.6,53.98,'F');
doc.setTextColor(255,215,0);
doc.setFontSize(12);
doc.text("CESAG Venture",5,12);
doc.text("CARTE MEMBRE",5,20);
doc.setTextColor(255,255,255);
doc.setFontSize(8);
doc.text(`Nom: ${nom}`,5,30);
doc.text(`Prénom: ${prenom}`,5,36);
doc.text(`Email: ${email}`,5,42);
doc.text(`Téléphone: ${telephone}`,5,48);
doc.text(`Section: ${section}`,5,54);

const qr = document.createElement("canvas");
new QRCode(qr,{text:"https://chat.whatsapp.com/votreGroupeCESAG",width:40,height:40});
doc.addImage(qr.toDataURL(),"PNG",65,10,20,20);

doc.save(`${prenom}_${nom}_CESAGVenture.pdf`);

backBtn.style.display="block";
form.reset();
});

window.onload=()=>document.getElementById("membershipFormContainer").classList.add("visible");
</script>

</body>
</html>